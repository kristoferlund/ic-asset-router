# 5.6 — Documentation & Examples

**Phase:** 5 — Developer Experience & Tooling
**Priority:** High
**Status:** Not started

## Problem

There is no rustdoc for public types and functions, no getting-started guide, and limited example code. New users must read the source to understand how to integrate the library. The library's features need to be validated against real-world canister patterns to confirm they work as intended.

## Pre-Implementation Step: Audit Existing Examples

Before creating new examples, audit what already exists in the `examples/` directory. Phase 3 creates several examples:

- `examples/askama-basic/` — Minimal Askama template integration
- `examples/tera-basic/` — Minimal Tera template integration
- `examples/htmx-app/` — Full HTMX SSR canister with Askama, partials, and dynamic routes

These already cover the SSR/template use case. Do not duplicate this work. Focus new examples on features not yet demonstrated.

## Objective

1. Add rustdoc to all public API surface
2. Create small, focused example canisters — each showcasing a specific feature subset
3. Write a getting-started guide and migration guide
4. Use examples as real-world validation that the library works as designed

## Specification

### Rustdoc

Add documentation comments to all public types and functions:

- `RouteNode` — How the trie works, how to insert routes
- `RouteContext<P, S>` — What fields are available, how params and search are populated
- `HandlerFn` / `HandlerResult` — What handlers return, how certification works
- `AssetConfig`, `SecurityHeaders`, `CacheControl` — Configuration options with examples
- `invalidate_path()`, `invalidate_prefix()`, `invalidate_all_dynamic()` — When and how to use cache invalidation
- `last_certified_at()` — When and how to check cache freshness
- `certify_all_assets()` — When to call, what it does

Each public item should have:
1. A one-line summary
2. A detailed description where needed
3. A code example (`/// # Examples`) for non-trivial items

### Example Design Principle: Small and Focused

Rather than building large showcase applications, create tiny example canisters that each demonstrate one or two features. This makes each example easy to understand, quick to compile, and useful as a reference for a specific integration question.

Each example should:
- Be a complete, compilable ICP canister (with `dfx.json`)
- Have its own `README.md` explaining what it demonstrates
- Be deployable to a local `dfx` replica
- Be minimal — the smallest possible canister that showcases the feature

Examples also serve as validation that the library works end-to-end for real use cases. The PocketIC E2E test suite (spec 5.7) uses a dedicated test canister for automated testing, but the examples here are meant for human readers and should prioritize clarity over test coverage. If an example doesn't compile or behave correctly when deployed, that's a library bug.

### Example Inventory

Check what exists before creating. The target set:

| Example | Features demonstrated | Status |
|---------|----------------------|--------|
| `examples/askama-basic/` | Askama template rendering | Phase 3 (exists) |
| `examples/tera-basic/` | Tera template rendering | Phase 3 (exists) |
| `examples/htmx-app/` | Full SSR with HTMX, partials, dynamic params | Phase 3 (exists) |
| `examples/security-headers/` | Configuring strict/permissive/custom security headers | **New** |
| `examples/json-api/` | JSON endpoints, method routing (GET/POST/PUT/DELETE), CORS middleware | **New** |
| `examples/cache-invalidation/` | TTL-based expiry, explicit invalidation, conditional regeneration | **New** |
| `examples/spa-meta-tags/` | SPA fallback, dynamic meta tag injection per route | **New** |
| `examples/custom-404/` | Custom not_found.rs handler returning styled HTML or JSON | **New** |

Each new example is intentionally small. For instance, `examples/security-headers/` might be a single-route canister that serves a page showing its own response headers — just enough to demonstrate the configuration.

### Getting Started Guide

A step-by-step guide in the library's `README.md`:

1. Add the dependency to `Cargo.toml`
2. Create the `src/routes/` directory
3. Add your first route (`index.rs`)
4. Configure the router in `lib.rs` (init, post_upgrade, http_request, http_request_update)
5. Deploy to a local replica (`dfx start`, `dfx deploy`)
6. Test in the browser

### Migration Guide

For existing users upgrading from the pre-Phase 1 version:
- Rename `:param.rs` files to `_param.rs`
- Rename `*.rs` to `all.rs`
- Update handler signatures from `(HttpRequest, RouteParams)` to `RouteContext<Params>` (if Phase 5.2 is complete)
- Update response types if using `DynamicResponse` / `HandlerResult` (if Phase 4.3 is complete)
- Security headers are now `permissive()` by default (was hardcoded `strict`)
- Cache-Control is now configurable (was hardcoded)

### Examples as Validation

Each example canister serves a dual purpose:
1. **Documentation** — shows users how to use a feature
2. **Validation** — confirms the library works end-to-end for that use case

If an example doesn't compile or doesn't behave as expected when deployed, that's a bug in the library, not just a documentation issue. The E2E test suite (spec 5.5) can optionally use these examples as test fixtures.

## Files to Modify

- All `src/*.rs` files — Add `///` documentation comments
- New: `examples/security-headers/` — Minimal canister
- New: `examples/json-api/` — JSON API canister
- New: `examples/cache-invalidation/` — Cache lifecycle canister
- New: `examples/spa-meta-tags/` — SPA with meta tags canister
- New: `examples/custom-404/` — Custom 404 handler canister
- `README.md` — Getting started guide, overview, links to examples
- New: `MIGRATION.md` — Upgrade guide from current version

## Acceptance Criteria

- [ ] Existing examples audited — no duplicate work
- [ ] All public types and functions have rustdoc with summary and description
- [ ] Non-trivial public items include `/// # Examples` code examples
- [ ] `cargo doc --no-deps` generates clean documentation with no warnings
- [ ] Each new example canister compiles (`cargo check`)
- [ ] Each new example canister deploys to a local `dfx` replica and behaves correctly
- [ ] Each example has its own README explaining what it demonstrates
- [ ] Getting started guide is complete and tested (a new user can follow it end-to-end)
- [ ] Migration guide covers all breaking changes from the pre-Phase 1 version
