# 1.6 — Minor Fixes

**Phase:** 1 — Fix Foundations
**Priority:** Low
**Status:** Not started

## Overview

A collection of small fixes that can be bundled together or addressed alongside the major Phase 1 items.

## Items

### 1.6.1 Typo in build.rs
**File:** `src/build.rs:6`
**Fix:** "Gnereates" → "Generates"

### 1.6.2 Missing MIME Types
**File:** `src/mime.rs`
**Add:** `avif`, `heic`, `csv`, `yaml`/`yml`, `map` (source maps), `webmanifest`

### 1.6.3 Fragile Double-Slash Fix
**File:** `src/build.rs`
**Problem:** `replace("//", "/")` is a single-pass replacement. Input `"///path"` becomes `"//path"` (still has double slash).
**Fix:** Use a loop or regex, or `path.split('/').filter(|s| !s.is_empty()).collect::<Vec<_>>().join("/")`
**Deferred to 5.1** — The entire build script is rewritten in spec 5.1 with the new `_param`/`all.rs` naming convention. Fixing this in the old build script is wasted work.

### 1.6.4 build.rs Mutates Source Tree
**File:** `src/build.rs`
**Problem:** Writes `mod.rs` files into `src/routes/`, which can conflict with version control and IDE indexing.
**Consider:** Writing to `OUT_DIR` instead, or using a proc macro approach. This may be a larger refactor — evaluate scope before committing.
**Deferred to 5.1** — Spec 5.1 moves route tree wiring into `OUT_DIR` and eliminates the need for generated `mod.rs` files by adopting legal Rust identifiers for all route filenames.

### 1.6.5 Unused Public Function
**File:** `src/assets.rs` (or wherever `collect_assets` lives)
**Problem:** `collect_assets` is `pub` but unused internally.
**Fix:** Either make it `pub(crate)`, remove it, or document it as part of the public API if consumers need it.

### 1.6.6 No Encoding Negotiation for Dynamic Assets
**Problem:** Static assets get Brotli/Gzip encoding variants. Dynamic assets are always served uncompressed.
**Consider:** Compressing dynamic responses when the client sends `Accept-Encoding: gzip` or `br`. May have certification implications — investigate whether compressed dynamic responses can be properly certified.

### 1.6.7 Skip-Certification Witnesses Against `"/"` Regardless of Request Path
**File:** `src/lib.rs` (the `certify: false` branch in `http_request`)
**Problem:** When `HttpRequestOptions { certify: false }` is used, the skip-certification proof is always created against path `"/"` — not the actual request path. This means the proof says "I'm allowed to skip certification at `/`" even if the request is for `/api/data`. It works because the boundary node accepts the skip proof, but it's semantically incorrect and could cause issues if path-specific skip-certification behavior is ever needed.
**Fix:** Use the actual request path when constructing the `HttpCertificationPath::exact(...)` and the corresponding tree entry, instead of hardcoding `"/"`.

### 1.6.8 Unused Dependencies in Cargo.toml
**File:** `Cargo.toml`
**Problem:** `ic-canister-sig-creation = "1.3.1"` is declared as a dependency but never imported in any source file. `candid` and `serde` are also declared but not directly used in library code (they may be needed by consumers who re-export types, but they should not be direct dependencies of the library if unused).
**Fix:** Audit all dependencies. Remove `ic-canister-sig-creation`. Evaluate whether `candid` and `serde` are genuinely needed or are transitive/consumer concerns. If consumers need them, they should declare them in their own `Cargo.toml`.

### 1.6.9 Inconsistent Leading Slashes in Generated Route Tree
**File:** `src/build.rs` (`file_to_route_path`)
**Problem:** The generated `__route_tree.rs` produces routes with inconsistent leading slashes. The root route is `""`, the catch-all is `"*"`, but deeper routes have leading slashes like `"/app/:id"`. The router handles this because `split('/').filter(|s| !s.is_empty())` normalizes everything, but the generated code is inconsistent and could confuse anyone reading it.
**Fix:** Normalize all generated route paths to have a consistent leading slash (e.g., `"/"`, `"/*"`, `"/app/:id"`).
**Deferred to 5.1** — The build script is fully rewritten in spec 5.1. Consistent path generation will be part of the new implementation.

## Acceptance Criteria

- [ ] Typo fixed
- [ ] All listed MIME types added with correct mappings
- [ ] `collect_assets` visibility is intentional and documented
- [ ] Skip-certification uses the actual request path, not hardcoded `"/"`
- [ ] `ic-canister-sig-creation` removed from dependencies; `candid`/`serde` audited
- [ ] Each item has a test or is verified manually

*Items 1.6.3, 1.6.4, and 1.6.9 are deferred to spec 5.1 (Build Script & IDE Ergonomics) where the build script is fully rewritten.*
