# 6.2 â€” Wildcard Value in RouteContext

## Problem

The trie router stores the wildcard capture in `RouteParams` under the key `"*"`, but `RouteContext` does not expose `RouteParams`. Handlers for catch-all routes (e.g., `files/all.rs` matching `/files/*`) cannot access the captured path without manually parsing `ctx.url`.

Discovered during Phase 5, Session 12: the test canister's `files/all.rs` handler had to strip the `/files/` prefix from `ctx.url` as a workaround.

## Specification

### Add `wildcard` field to `RouteContext`

Add a new field to `RouteContext` (`src/context.rs:58-76`):

```rust
pub struct RouteContext<P, S = ()> {
    pub params: P,
    pub search: S,
    pub query: QueryParams,
    pub method: Method,
    pub headers: Vec<HeaderField>,
    pub body: Vec<u8>,
    pub url: String,
    pub wildcard: Option<String>,  // NEW
}
```

- `None` for routes without a wildcard segment.
- `Some("docs/report.pdf")` for a request to `/files/docs/report.pdf` matching `/files/*`.

### Update generated wrappers

In `src/build.rs` (wrapper generation, lines 150-204), when constructing `RouteContext`:

- Extract `raw_params.get("*")` and map it to `Some(value.to_string())`.
- For routes that don't have a wildcard ancestor, set `wildcard: None`.

The build script already knows whether a route has a wildcard in its ancestry (the `all.rs` convention). Use this to generate the correct value.

### Update not-found wrapper

The not-found wrapper (`src/build.rs:207-222`) should also set `wildcard: None`.

### Files to modify

| File | Change |
|------|--------|
| `src/context.rs` | Add `pub wildcard: Option<String>` to `RouteContext` |
| `src/build.rs:150-204` | Populate `wildcard` from `raw_params.get("*")` in generated wrappers |
| `src/build.rs:207-222` | Set `wildcard: None` in not-found wrapper |
| `tests/e2e/test_canister/src/routes/files/all.rs` | Simplify to use `ctx.wildcard` instead of URL parsing |

### Acceptance criteria

- [ ] `RouteContext` has a `pub wildcard: Option<String>` field
- [ ] Catch-all route handler receives `ctx.wildcard == Some("docs/report.pdf")` for `/files/docs/report.pdf`
- [ ] Static route handler receives `ctx.wildcard == None`
- [ ] Param route handler (no wildcard) receives `ctx.wildcard == None`
- [ ] Test canister `files/all.rs` uses `ctx.wildcard` directly
- [ ] E2E test `test_wildcard_capture` still passes
- [ ] `cargo test` passes
