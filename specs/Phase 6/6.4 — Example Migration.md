# 6.4 â€” Example Migration

## Problem

Three example canisters created before or during earlier phases use outdated conventions:

### `examples/htmx-app/`
- Uses `:postId` directory naming (pre-Phase 5 convention). Should be `_postId`.
- Handler signatures use `(HttpRequest, RouteParams)` instead of `RouteContext<Params>`.
- `AssetConfig` struct literal missing the `cache_config` field added in Phase 4.
- Generates invalid `pub mod :postId;` in `mod.rs`.

Noted in Phase 5 Sessions 4, 10, 11.

### `examples/askama-basic/`
- Uses `include!("__route_tree.rs")` (src-relative) instead of `include!(concat!(env!("OUT_DIR"), "/__route_tree.rs"))`.
- Handler signature may use old `(HttpRequest, RouteParams)` pattern.

Noted in Phase 5 Session 11.

### `examples/tera-basic/`
- Same issues as `askama-basic`: old `include!` pattern and old handler signatures.

Noted in Phase 5 Session 11.

## Specification

### `htmx-app` migration

1. Rename `src/routes/posts/:postId/` to `src/routes/posts/_postId/`.
2. Update all handler functions to accept `RouteContext<Params>` (for parameterized routes) or `RouteContext<()>` (for static routes) instead of `(HttpRequest, RouteParams)`.
3. Access params via `ctx.params.post_id` instead of `params.get("postId")`.
4. Add `cache_config: CacheConfig::default()` to the `AssetConfig` struct in `src/lib.rs`.
5. Update the `include!` macro to use the OUT_DIR pattern.
6. Update `build.rs` if it uses any deprecated patterns.

### `askama-basic` migration

1. Update handler signatures to `RouteContext<Params>` or `RouteContext<()>`.
2. Update `include!` to `include!(concat!(env!("OUT_DIR"), "/__route_tree.rs"))`.
3. Update `AssetConfig` if used (add `cache_config`).
4. Rename any `:param` directories to `_param` if present.

### `tera-basic` migration

Same changes as `askama-basic`.

### Verification

Each example must compile cleanly:

```
cargo check --manifest-path examples/htmx-app/Cargo.toml
cargo check --manifest-path examples/askama-basic/Cargo.toml
cargo check --manifest-path examples/tera-basic/Cargo.toml
```

### Files to modify

| Directory | Changes |
|-----------|---------|
| `examples/htmx-app/` | Rename dirs, update handler sigs, add `cache_config`, update `include!` |
| `examples/askama-basic/` | Update handler sigs, update `include!`, add `cache_config` |
| `examples/tera-basic/` | Update handler sigs, update `include!`, add `cache_config` |

### Acceptance criteria

- [ ] No `:param` directories remain in any example
- [ ] All handlers use `RouteContext<Params>` or `RouteContext<()>`
- [ ] All examples use `include!(concat!(env!("OUT_DIR"), "/__route_tree.rs"))`
- [ ] All `AssetConfig` literals include `cache_config`
- [ ] `cargo check --manifest-path` succeeds for all three examples with zero errors
- [ ] `cargo build --target wasm32-unknown-unknown --manifest-path examples/htmx-app/Cargo.toml` succeeds
