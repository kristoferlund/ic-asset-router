# 6.8 — Expose URL Decode & Form Parse Utilities

## Problem

The library has a private `url_decode()` function in `src/context.rs:113` that handles percent-decoding and `+`-as-space conversion. The `examples/htmx-app/src/routes/posts/_postId/comments.rs` handler duplicates this logic with its own inline `url_decode()` and `parse_form_urlencoded()` functions (lines 72-99).

Example handlers should not contain hand-rolled URL decoding. The library should expose these utilities so examples (and users) can use them directly.

## Specification

### Make `url_decode` public

Change `fn url_decode(input: &str) -> Cow<'_, str>` in `src/context.rs:113` from `fn` to `pub fn`.

Re-export from `src/lib.rs`:
```rust
pub use context::{..., url_decode};
```

### Add `parse_form_body` utility

Add a new public function to `src/context.rs`:

```rust
pub fn parse_form_body(body: &[u8]) -> HashMap<String, String>
```

This parses an `application/x-www-form-urlencoded` body (the format submitted by HTML forms). Implementation:

1. Convert `body` to a UTF-8 string (lossy).
2. Split on `&`.
3. For each pair, split on `=` (max 2 parts).
4. URL-decode both key and value.
5. Return as `HashMap<String, String>`.

This is the same logic currently in `comments.rs:parse_form_urlencoded` but using the library's `url_decode`.

Re-export from `src/lib.rs`:
```rust
pub use context::{..., parse_form_body};
```

### Update htmx-app example

Replace the inline `parse_form_urlencoded` and `url_decode` in `examples/htmx-app/src/routes/posts/_postId/comments.rs` with:

```rust
use router_library::parse_form_body;

let fields = parse_form_body(&ctx.body);
```

Remove the ~30 lines of inline helper functions.

### Tests

Add unit tests in `src/context.rs`:

- `url_decode("hello%20world")` → `"hello world"`
- `url_decode("a+b")` → `"a b"`
- `url_decode("no%encoding")` → `"no%encoding"` (malformed passes through)
- `url_decode("plain")` → `"plain"` (no encoding, returns borrowed)
- `parse_form_body(b"name=Alice&age=30")` → `{"name": "Alice", "age": "30"}`
- `parse_form_body(b"q=hello+world")` → `{"q": "hello world"}`
- `parse_form_body(b"")` → empty map
- `parse_form_body(b"key=val%26ue")` → `{"key": "val&ue"}`

### Files to modify

| File | Change |
|------|--------|
| `src/context.rs` | Make `url_decode` public, add `parse_form_body`, add tests |
| `src/lib.rs` | Re-export `url_decode` and `parse_form_body` |
| `examples/htmx-app/src/routes/posts/_postId/comments.rs` | Replace inline helpers with library imports |

### Acceptance criteria

- [ ] `url_decode` is public and re-exported from `router_library`
- [ ] `parse_form_body` is public and re-exported from `router_library`
- [ ] htmx-app `comments.rs` uses library imports instead of inline helpers
- [ ] All unit tests pass
- [ ] `cargo check --manifest-path examples/htmx-app/Cargo.toml` succeeds
